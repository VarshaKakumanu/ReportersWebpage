import{g as qe}from"./js-base64-BbY-I90a.js";import{U as Ce}from"./url-parse-CpxSAbii.js";function le(t){"@babel/helpers - typeof";return le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(t)}function Be(t,e,r){return Object.defineProperty(t,"prototype",{writable:!1}),t}function Ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Me(t,e,r){return e=W(e),Ke(t,ve()?Reflect.construct(e,r||[],W(t).constructor):e.apply(t,r))}function Ke(t,e){if(e&&(le(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xe(t)}function Xe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ye(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}function se(t){var e=typeof Map=="function"?new Map:void 0;return se=function(n){if(n===null||!Je(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(n))return e.get(n);e.set(n,u)}function u(){return We(n,arguments,W(this).constructor)}return u.prototype=Object.create(n.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),Y(u,n)},se(t)}function We(t,e,r){if(ve())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var u=new(t.bind.apply(t,n));return r&&Y(u,r.prototype),u}function ve(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ve=function(){return!!t})()}function Je(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function Y(t,e){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,u){return n.__proto__=u,n},Y(t,e)}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},W(t)}var te=function(t){function e(r){var n,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(Ge(this,e),n=Me(this,e,[r]),n.originalRequest=l,n.originalResponse=c,n.causingError=u,u!=null&&(r+=", caused by ".concat(u.toString())),l!=null){var d=l.getHeader("X-Request-ID")||"n/a",h=l.getMethod(),y=l.getURL(),m=c?c.getStatus():"n/a",U=c?c.getBody()||"":"n/a";r+=", originated from request (method: ".concat(h,", url: ").concat(y,", response code: ").concat(m,", response text: ").concat(U,", request id: ").concat(d,")")}return n.message=r,n}return Ye(e,t),Be(e)}(se(Error));function J(t){"@babel/helpers - typeof";return J=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(t)}function Ve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,et(n.key),n)}}function Ze(t,e,r){return e&&Qe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function et(t){var e=tt(t,"string");return J(e)=="symbol"?e:e+""}function tt(t,e){if(J(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(J(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var rt=function(){function t(){Ve(this,t)}return Ze(t,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(r){return Promise.resolve([])}},{key:"removeUpload",value:function(r){return Promise.resolve()}},{key:"addUpload",value:function(r,n){return Promise.resolve(null)}}])}();function nt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,r=t==="x"?e:e&3|8;return r.toString(16)})}function fe(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */fe=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,u=Object.defineProperty||function(a,o,i){a[o]=i.value},l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",d=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function y(a,o,i){return Object.defineProperty(a,o,{value:i,enumerable:!0,configurable:!0,writable:!0}),a[o]}try{y({},"")}catch{y=function(i,s,p){return i[s]=p}}function m(a,o,i,s){var p=o&&o.prototype instanceof R?o:R,f=Object.create(p.prototype),v=new I(s||[]);return u(f,"_invoke",{value:ie(a,i,v)}),f}function U(a,o,i){try{return{type:"normal",arg:a.call(o,i)}}catch(s){return{type:"throw",arg:s}}}e.wrap=m;var D="suspendedStart",M="suspendedYield",H="executing",j="completed",_={};function R(){}function O(){}function w(){}var x={};y(x,c,function(){return this});var $=Object.getPrototypeOf,L=$&&$($(N([])));L&&L!==r&&n.call(L,c)&&(x=L);var k=w.prototype=R.prototype=Object.create(x);function K(a){["next","throw","return"].forEach(function(o){y(a,o,function(i){return this._invoke(o,i)})})}function T(a,o){function i(p,f,v,g){var b=U(a[p],a,f);if(b.type!=="throw"){var P=b.arg,S=P.value;return S&&z(S)=="object"&&n.call(S,"__await")?o.resolve(S.__await).then(function(E){i("next",E,v,g)},function(E){i("throw",E,v,g)}):o.resolve(S).then(function(E){P.value=E,v(P)},function(E){return i("throw",E,v,g)})}g(b.arg)}var s;u(this,"_invoke",{value:function(f,v){function g(){return new o(function(b,P){i(f,v,b,P)})}return s=s?s.then(g,g):g()}})}function ie(a,o,i){var s=D;return function(p,f){if(s===H)throw Error("Generator is already running");if(s===j){if(p==="throw")throw f;return{value:t,done:!0}}for(i.method=p,i.arg=f;;){var v=i.delegate;if(v){var g=X(v,i);if(g){if(g===_)continue;return g}}if(i.method==="next")i.sent=i._sent=i.arg;else if(i.method==="throw"){if(s===D)throw s=j,i.arg;i.dispatchException(i.arg)}else i.method==="return"&&i.abrupt("return",i.arg);s=H;var b=U(a,o,i);if(b.type==="normal"){if(s=i.done?j:M,b.arg===_)continue;return{value:b.arg,done:i.done}}b.type==="throw"&&(s=j,i.method="throw",i.arg=b.arg)}}}function X(a,o){var i=o.method,s=a.iterator[i];if(s===t)return o.delegate=null,i==="throw"&&a.iterator.return&&(o.method="return",o.arg=t,X(a,o),o.method==="throw")||i!=="return"&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+i+"' method")),_;var p=U(s,a.iterator,o.arg);if(p.type==="throw")return o.method="throw",o.arg=p.arg,o.delegate=null,_;var f=p.arg;return f?f.done?(o[a.resultName]=f.value,o.next=a.nextLoc,o.method!=="return"&&(o.method="next",o.arg=t),o.delegate=null,_):f:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,_)}function ae(a){var o={tryLoc:a[0]};1 in a&&(o.catchLoc=a[1]),2 in a&&(o.finallyLoc=a[2],o.afterLoc=a[3]),this.tryEntries.push(o)}function F(a){var o=a.completion||{};o.type="normal",delete o.arg,a.completion=o}function I(a){this.tryEntries=[{tryLoc:"root"}],a.forEach(ae,this),this.reset(!0)}function N(a){if(a||a===""){var o=a[c];if(o)return o.call(a);if(typeof a.next=="function")return a;if(!isNaN(a.length)){var i=-1,s=function p(){for(;++i<a.length;)if(n.call(a,i))return p.value=a[i],p.done=!1,p;return p.value=t,p.done=!0,p};return s.next=s}}throw new TypeError(z(a)+" is not iterable")}return O.prototype=w,u(k,"constructor",{value:w,configurable:!0}),u(w,"constructor",{value:O,configurable:!0}),O.displayName=y(w,h,"GeneratorFunction"),e.isGeneratorFunction=function(a){var o=typeof a=="function"&&a.constructor;return!!o&&(o===O||(o.displayName||o.name)==="GeneratorFunction")},e.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,w):(a.__proto__=w,y(a,h,"GeneratorFunction")),a.prototype=Object.create(k),a},e.awrap=function(a){return{__await:a}},K(T.prototype),y(T.prototype,d,function(){return this}),e.AsyncIterator=T,e.async=function(a,o,i,s,p){p===void 0&&(p=Promise);var f=new T(m(a,o,i,s),p);return e.isGeneratorFunction(o)?f:f.next().then(function(v){return v.done?v.value:f.next()})},K(k),y(k,h,"Generator"),y(k,c,function(){return this}),y(k,"toString",function(){return"[object Generator]"}),e.keys=function(a){var o=Object(a),i=[];for(var s in o)i.push(s);return i.reverse(),function p(){for(;i.length;){var f=i.pop();if(f in o)return p.value=f,p.done=!1,p}return p.done=!0,p}},e.values=N,I.prototype={constructor:I,reset:function(o){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!o)for(var i in this)i.charAt(0)==="t"&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var o=this.tryEntries[0].completion;if(o.type==="throw")throw o.arg;return this.rval},dispatchException:function(o){if(this.done)throw o;var i=this;function s(P,S){return v.type="throw",v.arg=o,i.next=P,S&&(i.method="next",i.arg=t),!!S}for(var p=this.tryEntries.length-1;p>=0;--p){var f=this.tryEntries[p],v=f.completion;if(f.tryLoc==="root")return s("end");if(f.tryLoc<=this.prev){var g=n.call(f,"catchLoc"),b=n.call(f,"finallyLoc");if(g&&b){if(this.prev<f.catchLoc)return s(f.catchLoc,!0);if(this.prev<f.finallyLoc)return s(f.finallyLoc)}else if(g){if(this.prev<f.catchLoc)return s(f.catchLoc,!0)}else{if(!b)throw Error("try statement without catch or finally");if(this.prev<f.finallyLoc)return s(f.finallyLoc)}}}},abrupt:function(o,i){for(var s=this.tryEntries.length-1;s>=0;--s){var p=this.tryEntries[s];if(p.tryLoc<=this.prev&&n.call(p,"finallyLoc")&&this.prev<p.finallyLoc){var f=p;break}}f&&(o==="break"||o==="continue")&&f.tryLoc<=i&&i<=f.finallyLoc&&(f=null);var v=f?f.completion:{};return v.type=o,v.arg=i,f?(this.method="next",this.next=f.finallyLoc,_):this.complete(v)},complete:function(o,i){if(o.type==="throw")throw o.arg;return o.type==="break"||o.type==="continue"?this.next=o.arg:o.type==="return"?(this.rval=this.arg=o.arg,this.method="return",this.next="end"):o.type==="normal"&&i&&(this.next=i),_},finish:function(o){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.finallyLoc===o)return this.complete(s.completion,s.afterLoc),F(s),_}},catch:function(o){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc===o){var p=s.completion;if(p.type==="throw"){var f=p.arg;F(s)}return f}}throw Error("illegal catch attempt")},delegateYield:function(o,i,s){return this.delegate={iterator:N(o),resultName:i,nextLoc:s},this.method==="next"&&(this.arg=t),_}},e}function be(t,e,r,n,u,l,c){try{var d=t[l](c),h=d.value}catch(y){r(y);return}d.done?e(h):Promise.resolve(h).then(n,u)}function ot(t){return function(){var e=this,r=arguments;return new Promise(function(n,u){var l=t.apply(e,r);function c(h){be(l,n,u,c,d,"next",h)}function d(h){be(l,n,u,c,d,"throw",h)}c(void 0)})}}function He(t,e){return ut(t)||at(t,e)||$e(t,e)||it()}function it(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function at(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,u,l,c,d=[],h=!0,y=!1;try{if(l=(r=r.call(t)).next,e!==0)for(;!(h=(n=l.call(r)).done)&&(d.push(n.value),d.length!==e);h=!0);}catch(m){y=!0,u=m}finally{try{if(!h&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(y)throw u}}return d}}function ut(t){if(Array.isArray(t))return t}function z(t){"@babel/helpers - typeof";return z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(t)}function lt(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=$e(t))||e){r&&(t=r);var n=0,u=function(){};return{s:u,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(y){throw y},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,c=!1,d;return{s:function(){r=r.call(t)},n:function(){var y=r.next();return l=y.done,y},e:function(y){c=!0,d=y},f:function(){try{!l&&r.return!=null&&r.return()}finally{if(c)throw d}}}}function $e(t,e){if(t){if(typeof t=="string")return _e(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _e(t,e)}}function _e(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function we(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),r.push.apply(r,n)}return r}function q(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?we(Object(r),!0).forEach(function(n){st(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function st(t,e,r){return e=Fe(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Se(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fe(n.key),n)}}function ct(t,e,r){return e&&Se(t.prototype,e),r&&Se(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Fe(t){var e=pt(t,"string");return z(e)=="symbol"?e:e+""}function pt(t,e){if(z(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(z(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var ce="tus-v1",re="ietf-draft-03",ht={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:Ie,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:ce},ne=function(){function t(e,r){ft(this,t),"resume"in r&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=r,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return ct(t,[{key:"findPreviousUploads",value:function(){var r=this;return this.options.fingerprint(this.file,this.options).then(function(n){return r._urlStorage.findUploadsByFingerprint(n)})}},{key:"resumeFromPreviousUpload",value:function(r){this.url=r.uploadUrl||null,this._parallelUploadUrls=r.parallelUploadUrls||null,this._urlStorageKey=r.urlStorageKey}},{key:"start",value:function(){var r=this,n=this.file;if(!n){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![ce,re].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var u=this.options.retryDelays;if(u!=null&&Object.prototype.toString.call(u)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var l=0,c=["uploadUrl","uploadSize","uploadLengthDeferred"];l<c.length;l++){var d=c[l];if(this.options[d]){this._emitError(new Error("tus: cannot use the ".concat(d," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(n,this.options).then(function(h){return r._fingerprint=h,r._source?r._source:r.options.fileReader.openFile(n,r.options.chunkSize)}).then(function(h){if(r._source=h,r.options.uploadLengthDeferred)r._size=null;else if(r.options.uploadSize!=null){if(r._size=Number(r.options.uploadSize),Number.isNaN(r._size)){r._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(r._size=r._source.size,r._size==null){r._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}r.options.parallelUploads>1||r._parallelUploadUrls!=null?r._startParallelUpload():r._startSingleUpload()}).catch(function(h){r._emitError(h)})}},{key:"_startParallelUpload",value:function(){var r,n=this,u=this._size,l=0;this._parallelUploads=[];var c=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,d=(r=this.options.parallelUploadBoundaries)!==null&&r!==void 0?r:yt(this._source.size,c);this._parallelUploadUrls&&d.forEach(function(m,U){m.uploadUrl=n._parallelUploadUrls[U]||null}),this._parallelUploadUrls=new Array(d.length);var h=d.map(function(m,U){var D=0;return n._source.slice(m.start,m.end).then(function(M){var H=M.value;return new Promise(function(j,_){var R=q(q({},n.options),{},{uploadUrl:m.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:n.options.metadataForPartialUploads,headers:q(q({},n.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:j,onError:_,onProgress:function(x){l=l-D+x,D=x,n._emitProgress(l,u)},onUploadUrlAvailable:function(){n._parallelUploadUrls[U]=O.url,n._parallelUploadUrls.filter(function(x){return!!x}).length===d.length&&n._saveUploadInUrlStorage()}}),O=new t(H,R);O.start(),n._parallelUploads.push(O)})})}),y;Promise.all(h).then(function(){y=n._openRequest("POST",n.options.endpoint),y.setHeader("Upload-Concat","final;".concat(n._parallelUploadUrls.join(" ")));var m=Ue(n.options.metadata);return m!==""&&y.setHeader("Upload-Metadata",m),n._sendRequest(y,null)}).then(function(m){if(!C(m.getStatus(),200)){n._emitHttpError(y,m,"tus: unexpected response while creating upload");return}var U=m.getHeader("Location");if(U==null){n._emitHttpError(y,m,"tus: invalid or missing Location header");return}n.url=ke(n.options.endpoint,U),"Created upload at ".concat(n.url),n._emitSuccess(m)}).catch(function(m){n._emitError(m)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(r){var n=this;if(this._parallelUploads!=null){var u=lt(this._parallelUploads),l;try{for(u.s();!(l=u.n()).done;){var c=l.value;c.abort(r)}}catch(d){u.e(d)}finally{u.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!r||this.url==null?Promise.resolve():t.terminate(this.url,this.options).then(function(){return n._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(r,n,u,l){this._emitError(new te(u,l,r,n))}},{key:"_emitError",value:function(r){var n=this;if(!this._aborted){if(this.options.retryDelays!=null){var u=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(u&&(this._retryAttempt=0),Oe(r,this._retryAttempt,this.options)){var l=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){n.start()},l);return}}if(typeof this.options.onError=="function")this.options.onError(r);else throw r}}},{key:"_emitSuccess",value:function(r){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:r})}},{key:"_emitProgress",value:function(r,n){typeof this.options.onProgress=="function"&&this.options.onProgress(r,n)}},{key:"_emitChunkComplete",value:function(r,n,u){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(r,n,u)}},{key:"_createUpload",value:function(){var r=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var n=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?n.setHeader("Upload-Defer-Length","1"):n.setHeader("Upload-Length","".concat(this._size));var u=Ue(this.options.metadata);u!==""&&n.setHeader("Upload-Metadata",u);var l;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,l=this._addChunkToRequest(n)):(this.options.protocol===re&&n.setHeader("Upload-Complete","?0"),l=this._sendRequest(n,null)),l.then(function(c){if(!C(c.getStatus(),200)){r._emitHttpError(n,c,"tus: unexpected response while creating upload");return}var d=c.getHeader("Location");if(d==null){r._emitHttpError(n,c,"tus: invalid or missing Location header");return}if(r.url=ke(r.options.endpoint,d),"Created upload at ".concat(r.url),typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._size===0){r._emitSuccess(c),r._source.close();return}r._saveUploadInUrlStorage().then(function(){r.options.uploadDataDuringCreation?r._handleUploadResponse(n,c):(r._offset=0,r._performUpload())})}).catch(function(c){r._emitHttpError(n,null,"tus: failed to create upload",c)})}},{key:"_resumeUpload",value:function(){var r=this,n=this._openRequest("HEAD",this.url),u=this._sendRequest(n,null);u.then(function(l){var c=l.getStatus();if(!C(c,200)){if(c===423){r._emitHttpError(n,l,"tus: upload is currently locked; retry later");return}if(C(c,400)&&r._removeFromUrlStorage(),!r.options.endpoint){r._emitHttpError(n,l,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}r.url=null,r._createUpload();return}var d=Number.parseInt(l.getHeader("Upload-Offset"),10);if(Number.isNaN(d)){r._emitHttpError(n,l,"tus: invalid or missing offset value");return}var h=Number.parseInt(l.getHeader("Upload-Length"),10);if(Number.isNaN(h)&&!r.options.uploadLengthDeferred&&r.options.protocol===ce){r._emitHttpError(n,l,"tus: invalid or missing length value");return}typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._saveUploadInUrlStorage().then(function(){if(d===h){r._emitProgress(h,h),r._emitSuccess(l);return}r._offset=d,r._performUpload()})}).catch(function(l){r._emitHttpError(n,null,"tus: failed to resume upload",l)})}},{key:"_performUpload",value:function(){var r=this;if(!this._aborted){var n;this.options.overridePatchMethod?(n=this._openRequest("POST",this.url),n.setHeader("X-HTTP-Method-Override","PATCH")):n=this._openRequest("PATCH",this.url),n.setHeader("Upload-Offset","".concat(this._offset));var u=this._addChunkToRequest(n);u.then(function(l){if(!C(l.getStatus(),200)){r._emitHttpError(n,l,"tus: unexpected response while uploading chunk");return}r._handleUploadResponse(n,l)}).catch(function(l){r._aborted||r._emitHttpError(n,null,"tus: failed to upload chunk at offset ".concat(r._offset),l)})}}},{key:"_addChunkToRequest",value:function(r){var n=this,u=this._offset,l=this._offset+this.options.chunkSize;return r.setProgressHandler(function(c){n._emitProgress(u+c,n._size)}),r.setHeader("Content-Type","application/offset+octet-stream"),(l===Number.POSITIVE_INFINITY||l>this._size)&&!this.options.uploadLengthDeferred&&(l=this._size),this._source.slice(u,l).then(function(c){var d=c.value,h=c.done,y=d!=null&&d.size?d.size:0;n.options.uploadLengthDeferred&&h&&(n._size=n._offset+y,r.setHeader("Upload-Length","".concat(n._size)));var m=n._offset+y;return!n.options.uploadLengthDeferred&&h&&m!==n._size?Promise.reject(new Error("upload was configured with a size of ".concat(n._size," bytes, but the source is done after ").concat(m," bytes"))):d===null?n._sendRequest(r):(n.options.protocol===re&&r.setHeader("Upload-Complete",h?"?1":"?0"),n._emitProgress(n._offset,n._size),n._sendRequest(r,d))})}},{key:"_handleUploadResponse",value:function(r,n){var u=Number.parseInt(n.getHeader("Upload-Offset"),10);if(Number.isNaN(u)){this._emitHttpError(r,n,"tus: invalid or missing offset value");return}if(this._emitProgress(u,this._size),this._emitChunkComplete(u-this._offset,u,this._size),this._offset=u,u===this._size){this._emitSuccess(n),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(r,n){var u=Pe(r,n,this.options);return this._req=u,u}},{key:"_removeFromUrlStorage",value:function(){var r=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(n){r._emitError(n)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var r=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var n={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?n.parallelUploadUrls=this._parallelUploadUrls:n.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,n).then(function(u){r._urlStorageKey=u})}},{key:"_sendRequest",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return Ee(r,n,this.options)}}],[{key:"terminate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=Pe("DELETE",r,n);return Ee(u,null,n).then(function(l){if(l.getStatus()!==204)throw new te("tus: unexpected response while terminating upload",null,u,l)}).catch(function(l){if(l instanceof te||(l=new te("tus: failed to terminate upload",l,u,null)),!Oe(l,0,n))throw l;var c=n.retryDelays[0],d=n.retryDelays.slice(1),h=q(q({},n),{},{retryDelays:d});return new Promise(function(y){return setTimeout(y,c)}).then(function(){return t.terminate(r,h)})})}}])}();function Ue(t){return Object.entries(t).map(function(e){var r=He(e,2),n=r[0],u=r[1];return"".concat(n," ").concat(qe.encode(String(u)))}).join(",")}function C(t,e){return t>=e&&t<e+100}function Pe(t,e,r){var n=r.httpStack.createRequest(t,e);r.protocol===re?n.setHeader("Upload-Draft-Interop-Version","5"):n.setHeader("Tus-Resumable","1.0.0");for(var u=r.headers||{},l=0,c=Object.entries(u);l<c.length;l++){var d=He(c[l],2),h=d[0],y=d[1];n.setHeader(h,y)}if(r.addRequestId){var m=nt();n.setHeader("X-Request-ID",m)}return n}function Ee(t,e,r){return pe.apply(this,arguments)}function pe(){return pe=ot(fe().mark(function t(e,r,n){var u;return fe().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(typeof n.onBeforeRequest!="function"){c.next=3;break}return c.next=3,n.onBeforeRequest(e);case 3:return c.next=5,e.send(r);case 5:if(u=c.sent,typeof n.onAfterResponse!="function"){c.next=9;break}return c.next=9,n.onAfterResponse(e,u);case 9:return c.abrupt("return",u);case 10:case"end":return c.stop()}},t)})),pe.apply(this,arguments)}function dt(){var t=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(t=!1),t}function Oe(t,e,r){return r.retryDelays==null||e>=r.retryDelays.length||t.originalRequest==null?!1:r&&typeof r.onShouldRetry=="function"?r.onShouldRetry(t,e,r):Ie(t)}function Ie(t){var e=t.originalResponse?t.originalResponse.getStatus():0;return(!C(e,400)||e===409||e===423)&&dt()}function ke(t,e){return new Ce(e,t).toString()}function yt(t,e){for(var r=Math.floor(t/e),n=[],u=0;u<e;u++)n.push({start:r*u,end:r*(u+1)});return n[e-1].end=t,n}ne.defaultOptions=ht;var Ne=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function vt(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var u=n.response;e(u)},n.onerror=function(u){r(u)},n.open("GET",t),n.send()})}var mt=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function gt(t){return new Promise(function(e,r){var n=new FileReader;n.onload=function(){var u=new Uint8Array(n.result);e({value:u})},n.onerror=function(u){r(u)},n.readAsArrayBuffer(t)})}function V(t){"@babel/helpers - typeof";return V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(t)}function bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,St(n.key),n)}}function wt(t,e,r){return e&&_t(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function St(t){var e=Ut(t,"string");return V(e)=="symbol"?e:e+""}function Ut(t,e){if(V(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(V(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var xe=function(){function t(e){bt(this,t),this._file=e,this.size=e.size}return wt(t,[{key:"slice",value:function(r,n){if(mt())return gt(this._file.slice(r,n));var u=this._file.slice(r,n),l=n>=this.size;return Promise.resolve({value:u,done:l})}},{key:"close",value:function(){}}])}();function Q(t){"@babel/helpers - typeof";return Q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(t)}function Pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,kt(n.key),n)}}function Ot(t,e,r){return e&&Et(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function kt(t){var e=xt(t,"string");return Q(e)=="symbol"?e:e+""}function xt(t,e){if(Q(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Q(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function je(t){return t===void 0?0:t.size!==void 0?t.size:t.length}function jt(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var r=new t.constructor(t.length+e.length);return r.set(t),r.set(e,t.length),r}throw new Error("Unknown data type")}var Rt=function(){function t(e){Pt(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}return Ot(t,[{key:"slice",value:function(r,n){return r<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(r,n)}},{key:"_readUntilEnoughDataOrDone",value:function(r,n){var u=this,l=n<=this._bufferOffset+je(this._buffer);if(this._done||l){var c=this._getDataFromBuffer(r,n),d=c==null?this._done:!1;return Promise.resolve({value:c,done:d})}return this._reader.read().then(function(h){var y=h.value,m=h.done;return m?u._done=!0:u._buffer===void 0?u._buffer=y:u._buffer=jt(u._buffer,y),u._readUntilEnoughDataOrDone(r,n)})}},{key:"_getDataFromBuffer",value:function(r,n){r>this._bufferOffset&&(this._buffer=this._buffer.slice(r-this._bufferOffset),this._bufferOffset=r);var u=je(this._buffer)===0;return this._done&&u?null:this._buffer.slice(0,n-r)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function A(t){"@babel/helpers - typeof";return A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(t)}function he(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */he=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,u=Object.defineProperty||function(a,o,i){a[o]=i.value},l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",d=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function y(a,o,i){return Object.defineProperty(a,o,{value:i,enumerable:!0,configurable:!0,writable:!0}),a[o]}try{y({},"")}catch{y=function(i,s,p){return i[s]=p}}function m(a,o,i,s){var p=o&&o.prototype instanceof R?o:R,f=Object.create(p.prototype),v=new I(s||[]);return u(f,"_invoke",{value:ie(a,i,v)}),f}function U(a,o,i){try{return{type:"normal",arg:a.call(o,i)}}catch(s){return{type:"throw",arg:s}}}e.wrap=m;var D="suspendedStart",M="suspendedYield",H="executing",j="completed",_={};function R(){}function O(){}function w(){}var x={};y(x,c,function(){return this});var $=Object.getPrototypeOf,L=$&&$($(N([])));L&&L!==r&&n.call(L,c)&&(x=L);var k=w.prototype=R.prototype=Object.create(x);function K(a){["next","throw","return"].forEach(function(o){y(a,o,function(i){return this._invoke(o,i)})})}function T(a,o){function i(p,f,v,g){var b=U(a[p],a,f);if(b.type!=="throw"){var P=b.arg,S=P.value;return S&&A(S)=="object"&&n.call(S,"__await")?o.resolve(S.__await).then(function(E){i("next",E,v,g)},function(E){i("throw",E,v,g)}):o.resolve(S).then(function(E){P.value=E,v(P)},function(E){return i("throw",E,v,g)})}g(b.arg)}var s;u(this,"_invoke",{value:function(f,v){function g(){return new o(function(b,P){i(f,v,b,P)})}return s=s?s.then(g,g):g()}})}function ie(a,o,i){var s=D;return function(p,f){if(s===H)throw Error("Generator is already running");if(s===j){if(p==="throw")throw f;return{value:t,done:!0}}for(i.method=p,i.arg=f;;){var v=i.delegate;if(v){var g=X(v,i);if(g){if(g===_)continue;return g}}if(i.method==="next")i.sent=i._sent=i.arg;else if(i.method==="throw"){if(s===D)throw s=j,i.arg;i.dispatchException(i.arg)}else i.method==="return"&&i.abrupt("return",i.arg);s=H;var b=U(a,o,i);if(b.type==="normal"){if(s=i.done?j:M,b.arg===_)continue;return{value:b.arg,done:i.done}}b.type==="throw"&&(s=j,i.method="throw",i.arg=b.arg)}}}function X(a,o){var i=o.method,s=a.iterator[i];if(s===t)return o.delegate=null,i==="throw"&&a.iterator.return&&(o.method="return",o.arg=t,X(a,o),o.method==="throw")||i!=="return"&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+i+"' method")),_;var p=U(s,a.iterator,o.arg);if(p.type==="throw")return o.method="throw",o.arg=p.arg,o.delegate=null,_;var f=p.arg;return f?f.done?(o[a.resultName]=f.value,o.next=a.nextLoc,o.method!=="return"&&(o.method="next",o.arg=t),o.delegate=null,_):f:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,_)}function ae(a){var o={tryLoc:a[0]};1 in a&&(o.catchLoc=a[1]),2 in a&&(o.finallyLoc=a[2],o.afterLoc=a[3]),this.tryEntries.push(o)}function F(a){var o=a.completion||{};o.type="normal",delete o.arg,a.completion=o}function I(a){this.tryEntries=[{tryLoc:"root"}],a.forEach(ae,this),this.reset(!0)}function N(a){if(a||a===""){var o=a[c];if(o)return o.call(a);if(typeof a.next=="function")return a;if(!isNaN(a.length)){var i=-1,s=function p(){for(;++i<a.length;)if(n.call(a,i))return p.value=a[i],p.done=!1,p;return p.value=t,p.done=!0,p};return s.next=s}}throw new TypeError(A(a)+" is not iterable")}return O.prototype=w,u(k,"constructor",{value:w,configurable:!0}),u(w,"constructor",{value:O,configurable:!0}),O.displayName=y(w,h,"GeneratorFunction"),e.isGeneratorFunction=function(a){var o=typeof a=="function"&&a.constructor;return!!o&&(o===O||(o.displayName||o.name)==="GeneratorFunction")},e.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,w):(a.__proto__=w,y(a,h,"GeneratorFunction")),a.prototype=Object.create(k),a},e.awrap=function(a){return{__await:a}},K(T.prototype),y(T.prototype,d,function(){return this}),e.AsyncIterator=T,e.async=function(a,o,i,s,p){p===void 0&&(p=Promise);var f=new T(m(a,o,i,s),p);return e.isGeneratorFunction(o)?f:f.next().then(function(v){return v.done?v.value:f.next()})},K(k),y(k,h,"Generator"),y(k,c,function(){return this}),y(k,"toString",function(){return"[object Generator]"}),e.keys=function(a){var o=Object(a),i=[];for(var s in o)i.push(s);return i.reverse(),function p(){for(;i.length;){var f=i.pop();if(f in o)return p.value=f,p.done=!1,p}return p.done=!0,p}},e.values=N,I.prototype={constructor:I,reset:function(o){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!o)for(var i in this)i.charAt(0)==="t"&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var o=this.tryEntries[0].completion;if(o.type==="throw")throw o.arg;return this.rval},dispatchException:function(o){if(this.done)throw o;var i=this;function s(P,S){return v.type="throw",v.arg=o,i.next=P,S&&(i.method="next",i.arg=t),!!S}for(var p=this.tryEntries.length-1;p>=0;--p){var f=this.tryEntries[p],v=f.completion;if(f.tryLoc==="root")return s("end");if(f.tryLoc<=this.prev){var g=n.call(f,"catchLoc"),b=n.call(f,"finallyLoc");if(g&&b){if(this.prev<f.catchLoc)return s(f.catchLoc,!0);if(this.prev<f.finallyLoc)return s(f.finallyLoc)}else if(g){if(this.prev<f.catchLoc)return s(f.catchLoc,!0)}else{if(!b)throw Error("try statement without catch or finally");if(this.prev<f.finallyLoc)return s(f.finallyLoc)}}}},abrupt:function(o,i){for(var s=this.tryEntries.length-1;s>=0;--s){var p=this.tryEntries[s];if(p.tryLoc<=this.prev&&n.call(p,"finallyLoc")&&this.prev<p.finallyLoc){var f=p;break}}f&&(o==="break"||o==="continue")&&f.tryLoc<=i&&i<=f.finallyLoc&&(f=null);var v=f?f.completion:{};return v.type=o,v.arg=i,f?(this.method="next",this.next=f.finallyLoc,_):this.complete(v)},complete:function(o,i){if(o.type==="throw")throw o.arg;return o.type==="break"||o.type==="continue"?this.next=o.arg:o.type==="return"?(this.rval=this.arg=o.arg,this.method="return",this.next="end"):o.type==="normal"&&i&&(this.next=i),_},finish:function(o){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.finallyLoc===o)return this.complete(s.completion,s.afterLoc),F(s),_}},catch:function(o){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc===o){var p=s.completion;if(p.type==="throw"){var f=p.arg;F(s)}return f}}throw Error("illegal catch attempt")},delegateYield:function(o,i,s){return this.delegate={iterator:N(o),resultName:i,nextLoc:s},this.method==="next"&&(this.arg=t),_}},e}function Re(t,e,r,n,u,l,c){try{var d=t[l](c),h=d.value}catch(y){r(y);return}d.done?e(h):Promise.resolve(h).then(n,u)}function Lt(t){return function(){var e=this,r=arguments;return new Promise(function(n,u){var l=t.apply(e,r);function c(h){Re(l,n,u,c,d,"next",h)}function d(h){Re(l,n,u,c,d,"throw",h)}c(void 0)})}}function Tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$t(n.key),n)}}function Ht(t,e,r){return e&&Dt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function $t(t){var e=Ft(t,"string");return A(e)=="symbol"?e:e+""}function Ft(t,e){if(A(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(A(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var It=function(){function t(){Tt(this,t)}return Ht(t,[{key:"openFile",value:function(){var e=Lt(he().mark(function n(u,l){var c;return he().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(Ne()&&u&&typeof u.uri<"u")){h.next=11;break}return h.prev=1,h.next=4,vt(u.uri);case 4:return c=h.sent,h.abrupt("return",new xe(c));case 8:throw h.prev=8,h.t0=h.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(h.t0));case 11:if(!(typeof u.slice=="function"&&typeof u.size<"u")){h.next=13;break}return h.abrupt("return",Promise.resolve(new xe(u)));case 13:if(typeof u.read!="function"){h.next=18;break}if(l=Number(l),Number.isFinite(l)){h.next=17;break}return h.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return h.abrupt("return",Promise.resolve(new Rt(u,l)));case 18:return h.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return h.stop()}},n,null,[[1,8]])}));function r(n,u){return e.apply(this,arguments)}return r}()}])}();function Nt(t,e){return Ne()?Promise.resolve(zt(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}function zt(t,e){var r=t.exif?At(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",r,e.endpoint].join("/")}function At(t){var e=0;if(t.length===0)return e;for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);e=(e<<5)-e+n,e&=e}return e}function Z(t){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(t)}function me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ct(n.key),n)}}function ge(t,e,r){return e&&qt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ct(t){var e=Bt(t,"string");return Z(e)=="symbol"?e:e+""}function Bt(t,e){if(Z(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Z(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Gt=function(){function t(){me(this,t)}return ge(t,[{key:"createRequest",value:function(r,n){return new Mt(r,n)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),Mt=function(){function t(e,r){me(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,r,!0),this._method=e,this._url=r,this._headers={}}return ge(t,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(r,n){this._xhr.setRequestHeader(r,n),this._headers[r]=n}},{key:"getHeader",value:function(r){return this._headers[r]}},{key:"setProgressHandler",value:function(r){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(n){n.lengthComputable&&r(n.loaded)})}},{key:"send",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(u,l){r._xhr.onload=function(){u(new Kt(r._xhr))},r._xhr.onerror=function(c){l(c)},r._xhr.send(n)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Kt=function(){function t(e){me(this,t),this._xhr=e}return ge(t,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(r){return this._xhr.getResponseHeader(r)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function ee(t){"@babel/helpers - typeof";return ee=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(t)}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Jt(n.key),n)}}function Wt(t,e,r){return e&&Yt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Jt(t){var e=Vt(t,"string");return ee(e)=="symbol"?e:e+""}function Vt(t,e){if(ee(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(ee(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var de=!1;try{de="localStorage"in window;var ue="tusSupport",Le=localStorage.getItem(ue);localStorage.setItem(ue,Le),Le===null&&localStorage.removeItem(ue)}catch(t){if(t.code===t.SECURITY_ERR||t.code===t.QUOTA_EXCEEDED_ERR)de=!1;else throw t}var Qt=de,Zt=function(){function t(){Xt(this,t)}return Wt(t,[{key:"findAllUploads",value:function(){var r=this._findEntries("tus::");return Promise.resolve(r)}},{key:"findUploadsByFingerprint",value:function(r){var n=this._findEntries("tus::".concat(r,"::"));return Promise.resolve(n)}},{key:"removeUpload",value:function(r){return localStorage.removeItem(r),Promise.resolve()}},{key:"addUpload",value:function(r,n){var u=Math.round(Math.random()*1e12),l="tus::".concat(r,"::").concat(u);return localStorage.setItem(l,JSON.stringify(n)),Promise.resolve(l)}},{key:"_findEntries",value:function(r){for(var n=[],u=0;u<localStorage.length;u++){var l=localStorage.key(u);if(l.indexOf(r)===0)try{var c=JSON.parse(localStorage.getItem(l));c.urlStorageKey=l,n.push(c)}catch{}}return n}}])}();function G(t){"@babel/helpers - typeof";return G=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(t)}function er(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ae(n.key),n)}}function rr(t,e,r){return r&&tr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function nr(t,e,r){return e=oe(e),or(t,ze()?Reflect.construct(e,r||[],oe(t).constructor):e.apply(t,r))}function or(t,e){if(e&&(G(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ir(t)}function ir(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ze(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ze=function(){return!!t})()}function oe(t){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},oe(t)}function ar(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ye(t,e)}function ye(t,e){return ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,u){return n.__proto__=u,n},ye(t,e)}function Te(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),r.push.apply(r,n)}return r}function B(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Te(Object(r),!0).forEach(function(n){ur(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ur(t,e,r){return e=Ae(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ae(t){var e=lr(t,"string");return G(e)=="symbol"?e:e+""}function lr(t,e){if(G(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(G(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var De=B(B({},ne.defaultOptions),{},{httpStack:new Gt,fileReader:new It,urlStorage:Qt?new Zt:new rt,fingerprint:Nt}),cr=function(t){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return er(this,e),n=B(B({},De),n),nr(this,e,[r,n])}return ar(e,t),rr(e,null,[{key:"terminate",value:function(n){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return u=B(B({},De),u),ne.terminate(n,u)}}])}(ne);export{cr as U,De as d};
